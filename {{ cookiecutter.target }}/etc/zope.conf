{% import 'db.conf' as db with context %}
# This file was generated by "cookiecutter-zope-instance"
%define INSTANCEHOME {{ cookiecutter.location_instancehome }}
instancehome $INSTANCEHOME

%define CLIENTHOME {{ cookiecutter.location_clienthome | abspath }}
clienthome $CLIENTHOME

debug-mode {{ "on" if cookiecutter.debug_mode else "off" }}
security-policy-implementation {{ "PYTHON" if cookiecutter.verbose_security else "C"}}
verbose-security {{ "on" if cookiecutter.verbose_security else "off" }}

default-zpublisher-encoding utf-8

{%- if cookiecutter.environment %}
<environment>
{%- for key, value in cookiecutter.environment|dictsort %}
{%- if key in cookiecutter.environment_paths %}
    {{ key }} {{ value | abspath}}
{%- else %}
    {{ key }} {{ value }}
{%- endif %}
{%- endfor %}
</environment>
{%- endif %}

{%- if cookiecutter.dos_protection_available %}
<dos_protection>
    form-memory-limit {{ cookiecutter.dos_protection_form_memory_limit }}
    form-disk-limit {{ cookiecutter.dos_protection_form_disk_limit }}
    form-memfile-limit {{ cookiecutter.dos_protection_form_memfile_limit }}
</dos_protection>
{%- endif %}

# Database
<zodb_db main>
    mount-point /
    cache-size {{ cookiecutter.db_cache_size }}
{%- if cookiecutter.db_cache_size_bytes %}
    cache-size-bytes {{ cookiecutter.db_cache_size_bytes }}
{%- endif %}
{%- if cookiecutter.db_large_record_size %}
    large-record-size {{ cookiecutter.db_large_record_size }}
{%- endif %}
{%- if cookiecutter.db_pool_size %}
    pool-size {{ cookiecutter.db_pool_size }}
{%- endif %}
{%- if cookiecutter.db_storage == "direct" %}
    {{ db.filestorage(
        cookiecutter.db_filestorage_location,
        cookiecutter.db_blobs_location,
        cookiecutter.db_filestorage_pack_keep_old,
        cookiecutter.db_filestorage_quota,
        cookiecutter.db_filestorage_packer,
        cookiecutter.db_filestorage_pack_gc
    ) }}
{%- endif %}
{%- if cookiecutter.db_storage == "relstorage" %}
{% filter indent(width=4) %}
    {{ db.relstorage(
        cookiecutter.db_blobs_mode,
        cookiecutter.db_blobs_location,
        cookiecutter.db_relstorage_keep_history,
        cookiecutter.db_relstorage_read_only,
        cookiecutter.db_relstorage_create_schema,
        cookiecutter.db_relstorage_commit_lock_timeout,
        cookiecutter.db_relstorage_blob_cache_size_check_external,
        cookiecutter.db_relstorage_blob_chunk_size,
        cookiecutter.db_relstorage_cache_local_mb,
        cookiecutter.db_relstorage_cache_local_object_max,
        cookiecutter.db_relstorage_cache_local_compression,
        cookiecutter.db_relstorage_cache_local_dir,
        cookiecutter.db_relstorage_cache_prefix,
        cookiecutter.db_relstorage_replica_conf,
        cookiecutter.db_relstorage_ro_replica_conf,
        cookiecutter.db_relstorage_replica_timeout,
        cookiecutter.db_relstorage_replica_revert_when_stale,
        cookiecutter.db_relstorage,
        cookiecutter.db_relstorage_postgresql_driver,
        cookiecutter.db_relstorage_postgresql_dsn,
        cookiecutter.db_relstorage_mysql_driver,
        cookiecutter.db_relstorage_mysql_parameters,
        cookiecutter.db_relstorage_oracle_driver,
        cookiecutter.db_relstorage_commit_lock_id,
        cookiecutter.db_relstorage_oracle_user,
        cookiecutter.db_relstorage_oracle_password,
        cookiecutter.db_relstorage_oracle_dsn,
        cookiecutter.db_relstorage_sqlite3_driver,
        cookiecutter.db_relstorage_sqlite3_data_dir,
        cookiecutter.db_relstorage_sqlite3_gevent_yield_interval,
        cookiecutter.db_relstorage_sqlite3_pragma,
        ""
    ) }}
{% endfilter %}
{%- endif %}
{%- if cookiecutter.db_storage == "zeo" %}
    {{ db.zeo(
        cookiecutter.db_blobs_mode,
        cookiecutter.db_blobs_location,
        cookiecutter.db_zeo_server,
        cookiecutter.db_zeo_name,
        cookiecutter.db_zeo_client,
        cookiecutter.db_zeo_var,
        cookiecutter.db_zeo_cache_size,
        cookiecutter.db_zeo_username,
        cookiecutter.db_zeo_password,
        cookiecutter.db_zeo_realm,
        cookiecutter.db_zeo_read_only_fallback,
        cookiecutter.db_zeo_read_only,
        cookiecutter.db_zeo_drop_cache_rather_verify,
    ) }}
{%- endif %}
</zodb_db>
